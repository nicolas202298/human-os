<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>HUMAN-OS | Sovereign Cloud</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root { --main: #00f2ff; --bg: #000; --card: #0d0d0d; --border: rgba(255,255,255,0.1); --gold: #d4af37; }
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Inter', sans-serif; }
        body { background: var(--bg); color: #fff; overflow: hidden; height: 100vh; }

        /* Login Screen */
        #auth-screen { height: 100vh; display: flex; align-items: center; justify-content: center; background: radial-gradient(circle, #111 0%, #000 100%); }
        .auth-box { background: var(--card); padding: 40px; border-radius: 20px; border: 1px solid var(--border); width: 90%; max-width: 380px; text-align: center; }
        input { width: 100%; padding: 14px; margin: 10px 0; background: #050505; border: 1px solid #222; color: #fff; border-radius: 10px; outline: none; transition: 0.3s; }
        input:focus { border-color: var(--main); }
        .btn { background: var(--main); color: #000; border: none; padding: 15px; width: 100%; border-radius: 10px; font-weight: 900; cursor: pointer; text-transform: uppercase; margin-top: 15px; }

        /* App Interface */
        #app-interface { display: none; height: 100vh; flex-direction: column; }
        header { padding: 15px 20px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; background: #000; }
        #flow { flex-grow: 1; overflow-y: auto; padding: 25px; display: flex; flex-direction: column; gap: 20px; }
        .block { padding: 20px; border-radius: 14px; font-size: 14px; line-height: 1.7; animation: fadeInUp 0.4s ease; }
        .block.ai { background: var(--card); border: 1px solid var(--border); align-self: stretch; color: #ddd; }
        .block.user { border-left: 3px solid var(--gold); align-self: flex-start; color: #777; font-style: italic; background: rgba(212, 175, 55, 0.05); }

        footer { padding: 20px; background: #000; border-top: 1px solid var(--border); }
        .input-wrap { background: #0a0a0a; border: 1px solid #222; border-radius: 18px; padding: 12px; }
        textarea { background: transparent; border: none; color: #fff; width: 100%; min-height: 50px; outline: none; font-size: 16px; resize: none; }
        .actions { display: flex; justify-content: space-between; align-items: center; margin-top: 10px; }
        
        #destilar-btn { background: var(--main); color: #000; border: none; padding: 10px 22px; border-radius: 10px; font-weight: 900; cursor: pointer; font-size: 11px; }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <section id="auth-screen">
        <div class="auth-box">
            <h1 style="letter-spacing: 5px; font-size: 20px; margin-bottom: 5px;">HUMAN-<span>OS</span></h1>
            <p style="color: #444; font-size: 10px; margin-bottom: 30px;">SOVEREIGN ACCESS TERMINAL</p>
            <input type="email" id="email" placeholder="Email">
            <input type="password" id="password" placeholder="Senha">
            <button class="btn" onclick="handleAuth()">Acessar Kernel</button>
            <p id="auth-msg" style="font-size: 10px; color: var(--main); margin-top: 15px;"></p>
        </div>
    </section>

    <section id="app-interface">
        <header>
            <div style="font-weight: 900; font-size: 14px; letter-spacing: 2px;">HUMAN-<span>OS</span></div>
            <div style="display:flex; gap: 15px; align-items: center;">
                <input type="password" id="groq-key" placeholder="GROQ_KEY" style="width: 80px; font-size: 8px; margin:0; padding: 5px; background:transparent;">
                <button onclick="logout()" style="background:none; border:none; color:#444; font-size:9px; cursor:pointer;">LOGOUT</button>
            </div>
        </header>

        <div id="flow">
            <div class="block ai"><b>KERNEL:</b> Conexão segura estabelecida. Histórico sincronizado na nuvem. Despeje o seu pensamento.</div>
        </div>

        <footer>
            <div class="input-wrap">
                <textarea id="cmd" placeholder="Qual o próximo nível da sua estratégia?"></textarea>
                <div class="actions">
                    <span style="font-size: 8px; color: #333;">ENCRYPTED CLOUD SESSION</span>
                    <button id="destilar-btn" onclick="destilar()">Destilar</button>
                </div>
            </div>
        </footer>
    </section>

<script>
    // CREDENCIAIS SUPABASE (INTEGRADAS)
    const SUPABASE_URL = 'https://fddzojlntzmhmekckplm.supabase.co';
    const SUPABASE_KEY = 'sb_publishable_7_YgjAZyC2bhR0frG7B3bg_ACdUYUL5';
    const _supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    let user = null;

    async function handleAuth() {
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;
        const msg = document.getElementById('auth-msg');

        msg.innerText = "Verificando Credenciais...";
        
        const { data, error } = await _supabase.auth.signInWithPassword({ email, password });
        
        if (error) {
            const { data: upData, error: upError } = await _supabase.auth.signUp({ email, password });
            if (upError) { msg.innerText = "Erro: " + upError.message; return; }
            msg.innerText = "Conta criada! Verifique seu e-mail.";
        } else {
            user = data.user;
            showApp();
        }
    }

    function showApp() {
        document.getElementById('auth-screen').style.display = 'none';
        document.getElementById('app-interface').style.display = 'flex';
        document.getElementById('groq-key').value = localStorage.getItem('gkey') || '';
        loadHistory();
    }

    async function logout() { await _supabase.auth.signOut(); location.reload(); }

    async function destilar() {
        const groqKey = document.getElementById('groq-key').value.trim();
        const cmd = document.getElementById('cmd');
        const text = cmd.value.trim();
        
        if (!text || !groqKey) { alert("Chave API Groq necessária!"); return; }
        localStorage.setItem('gkey', groqKey);

        // UI Update
        addBlock('user', text);
        cmd.value = "";

        try {
            const res = await fetch("https://api.groq.com/openai/v1/chat/completions", {
                method: "POST",
                headers: { "Authorization": `Bearer ${groqKey}`, "Content-Type": "application/json" },
                body: JSON.stringify({
                    model: "llama-3.3-70b-versatile",
                    messages: [{role: "system", content: "Você é o Kernel do Human-OS. Estruture o caos em CLAREZA e AÇÃO."}, {role: "user", content: text}]
                })
            });
            const data = await res.json();
            const reply = data.choices[0].message.content;

            addBlock('ai', reply);
            
            // SALVAR NO SUPABASE
            await _supabase.from('insights').insert([{ user_id: user.id, content: reply, type: 'ai' }]);
        } catch (e) { console.error(e); }
    }

    function addBlock(type, content) {
        const flow = document.getElementById('flow');
        flow.innerHTML += `<div class="block ${type}">${content.replace(/\n/g, '<br>')}</div>`;
        flow.scrollTop = flow.scrollHeight;
    }

    async function loadHistory() {
        const { data } = await _supabase.from('insights').select('*').order('created_at', { ascending: true });
        if(data) data.forEach(i => addBlock(i.type, i.content));
    }
</script>
</body>
</html>
